<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapka - Найди кружок для ребёнка</title>
  <meta name="description" content="Поиск детских кружков и секций на карте">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      color: #1a1a1a;
      min-height: 100vh;
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: #565555;
      color: white;
    }

    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      height: 56px;
      gap: 16px;
    }

    .logo {
      height: 32px;
      font-size: 24px;
      font-weight: bold;
      color: white;
      text-decoration: none;
    }

    .nav-desktop {
      display: none;
      align-items: center;
      gap: 20px;
      margin-right: auto;
    }

    .nav-desktop a {
      color: white;
      text-decoration: none;
      transition: opacity 0.2s;
    }

    .nav-desktop a:hover {
      opacity: 0.8;
    }

    .header-right-desktop {
      display: none;
      align-items: center;
      gap: 24px;
    }

    .header-right-desktop a {
      color: white;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-right-mobile {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .icon-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 4px;
    }

    .icon-btn svg {
      width: 24px;
      height: 24px;
    }

    /* Mobile Menu */
    .mobile-menu-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 100;
    }

    .mobile-menu-overlay.active {
      display: block;
    }

    .mobile-menu {
      position: fixed;
      right: 0;
      top: 0;
      height: 100%;
      width: 288px;
      background: #565555;
      color: white;
      z-index: 101;
      transform: translateX(100%);
      transition: transform 0.3s;
    }

    .mobile-menu.active {
      transform: translateX(0);
    }

    .mobile-menu-header {
      display: flex;
      justify-content: flex-end;
      padding: 16px;
    }

    .mobile-menu-content {
      padding: 24px;
    }

    .mobile-menu-profile {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      margin-bottom: 24px;
    }

    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #888;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mobile-menu nav {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .mobile-menu nav a {
      color: white;
      text-decoration: none;
    }

    /* Main Layout */
    .main-desktop {
      display: none;
      position: relative;
      height: calc(100vh - 64px);
    }

    .map-container {
      position: absolute;
      inset: 0;
      background: #e5e5e5;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
    }

    .left-panel {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 800px;
      max-width: 50%;
      display: flex;
      flex-direction: column;
      padding: 16px;
      gap: 16px;
      z-index: 10;
    }

    .cards-container {
      flex: 1;
      background: white;
      border-radius: 24px;
      overflow-y: auto;
      padding: 16px;
    }

    .cards-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Search Filter */
    .search-filter {
      display: flex;
      gap: 8px;
      height: 40px;
    }

    .filter-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 16px;
      background: #69AFDF;
      color: white;
      border: none;
      border-radius: 24px;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .filter-btn:hover {
      transform: scale(1.02);
    }

    .search-box {
      flex: 1;
      display: flex;
      background: #69AFDF;
      border-radius: 24px;
      padding: 2px;
    }

    .search-box input {
      flex: 1;
      min-width: 0;
      background: white;
      border: none;
      border-radius: 24px;
      padding: 0 16px;
      font-size: 14px;
      outline: none;
    }

    .search-box button {
      padding: 0 16px;
      background: none;
      border: none;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    /* Club Card */
    .club-card {
      background: #d1d1d1;
      border-radius: 24px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card-top {
      display: flex;
      gap: 8px;
    }

    .card-image {
      position: relative;
      width: 92px;
      height: 92px;
      border-radius: 16px;
      overflow: hidden;
      flex-shrink: 0;
      background: #ccc;
    }

    .card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .favorite-btn {
      position: absolute;
      top: 8px;
      left: 8px;
      background: none;
      border: none;
      cursor: pointer;
    }

    .favorite-btn svg {
      width: 24px;
      height: 24px;
      color: white;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
    }

    .favorite-btn.active svg {
      fill: #ef4444;
      color: #ef4444;
    }

    .card-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 0;
    }

    .card-title {
      background: white;
      border-radius: 16px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: normal;
    }

    .card-description {
      background: white;
      border-radius: 16px;
      padding: 8px 12px;
      flex: 1;
      overflow-y: auto;
      font-size: 12px;
      line-height: 1.5;
    }

    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag-btn {
      background: white;
      color: #1a1a1a;
      font-size: 10px;
      padding: 4px 8px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tag-btn:hover {
      background: #69AFDF;
      color: white;
    }

    .card-bottom {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card-location {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: #1a1a1a;
    }

    .card-location svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .card-buttons {
      display: flex;
      gap: 8px;
    }

    .card-btn {
      background: #69AFDF;
      color: white;
      padding: 8px 12px;
      border-radius: 12px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.2s;
      text-decoration: none;
    }

    .card-btn:hover {
      transform: scale(1.02);
    }

    /* Mobile Layout */
    .main-mobile {
      display: block;
    }

    .mobile-map {
      position: fixed;
      inset: 0;
      top: 56px;
      z-index: 0;
      background: #e5e5e5;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
      transition: height 0.3s;
    }

    /* Bottom Sheet */
    .bottom-sheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: white;
      border-radius: 24px 24px 0 0;
      z-index: 30;
      touch-action: none;
      transition: transform 0.3s ease-out;
      max-height: calc(100vh - 56px);
    }

    .bottom-sheet.peek {
      transform: translateY(calc(100% - 84px));
    }

    .bottom-sheet.split {
      transform: translateY(50%);
    }

    .bottom-sheet.full {
      transform: translateY(0);
    }

    .sheet-handle {
      display: flex;
      justify-content: center;
      padding: 12px;
      cursor: grab;
    }

    .handle-bar {
      width: 48px;
      height: 4px;
      background: #d1d1d1;
      border-radius: 2px;
    }

    .sheet-content {
      padding: 0 16px 24px;
      overflow-y: auto;
      max-height: calc(100vh - 56px - 28px);
    }

    .sheet-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 16px;
    }

    /* Desktop styles */
    @media (min-width: 768px) {
      .header-inner {
        padding: 0 40px;
        height: 64px;
      }

      .logo {
        height: 40px;
      }

      .nav-desktop {
        display: flex;
      }

      .header-right-desktop {
        display: flex;
      }

      .header-right-mobile {
        display: none;
      }

      .main-desktop {
        display: block;
      }

      .main-mobile {
        display: none;
      }

      .search-filter {
        height: 72px;
      }

      .filter-btn {
        padding: 0 56px 0 40px;
        font-size: 20px;
      }

      .search-box {
        padding: 4px;
      }

      .search-box input {
        padding: 0 24px;
        font-size: 20px;
      }

      .search-box button {
        padding: 0 32px;
        font-size: 20px;
      }

      .card-image {
        width: 250px;
        height: 250px;
        border-radius: 24px;
      }

      .card-title {
        border-radius: 24px;
        padding: 8px 24px;
        font-size: 24px;
      }

      .card-description {
        border-radius: 24px;
        padding: 16px;
        font-size: 16px;
      }

      .card-tags {
        gap: 8px;
      }

      .tag-btn {
        font-size: 14px;
        padding: 4px 12px;
      }

      .card-bottom {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .card-location {
        font-size: 16px;
        order: 2;
      }

      .card-location svg {
        width: 24px;
        height: 24px;
      }

      .card-buttons {
        order: 1;
      }

      .card-btn {
        padding: 8px 16px;
        border-radius: 24px;
        font-size: 16px;
      }
    }
  </style>
  <script>// js/map.js — обновлённый: метки с видимыми подписями и кликом
(async function initMap() {
  try { await ymaps3.ready; } catch (e) { console.error('ymaps3.ready failed', e); return; }

  const { YMap, YMapDefaultSchemeLayer, YMapDefaultFeaturesLayer, YMapMarker } = ymaps3;

  const rostovLocation = { center: [39.711515, 47.236171], zoom: 12 }; // [lng, lat]

  const map = new YMap(document.getElementById('map'), { location: rostovLocation });
  map.addChild(new YMapDefaultSchemeLayer());
  map.addChild(new YMapDefaultFeaturesLayer());

  const GEOCODE_API_KEY = '58c38b72-57f7-4946-bc13-a256d341281a';

  async function geocodeAddress(address) {
    if (!address) return null;
    const url = `https://geocode-maps.yandex.ru/1.x/?format=json&geocode=${encodeURIComponent(address)}&apikey=${GEOCODE_API_KEY}&results=1`;
    try {
      const r = await fetch(url);
      if (!r.ok) { console.warn('Geocode HTTP error', r.status); return null; }
      const json = await r.json();
      const fm = json?.response?.GeoObjectCollection?.featureMember;
      if (Array.isArray(fm) && fm.length) {
        const pos = fm[0].GeoObject?.Point?.pos;
        if (pos) {
          const [lng, lat] = pos.split(' ').map(Number);
          if (!Number.isNaN(lng) && !Number.isNaN(lat)) return [lng, lat];
        }
      }
      return null;
    } catch (err) {
      console.error('Fetch geocode failed', err);
      return null;
    }
  }

  // Нормализует строку адреса для точного поиска карточки (убираем лишние пробелы и "г.")
  function normalizeAddress(str) {
    return (str || '').replace(/^г\.\s*/i, '').replace(/\s+/g, ' ').trim().toLowerCase();
  }

  // Создаём DOM-метку: точка + подпись
  function createMarkerElement(title = '', rawAddress = '') {
    const el = document.createElement('div');
    el.className = 'custom-marker';
    el.style.position = 'relative';
    el.style.pointerEvents = 'auto';
    el.setAttribute('data-address', normalizeAddress(rawAddress));

    // точка (иконка)
    const dot = document.createElement('div');
    dot.className = 'custom-marker-dot';
    dot.style.width = '18px';
    dot.style.height = '18px';
    dot.style.borderRadius = '50%';
    dot.style.background = '#e74c3c';
    dot.style.boxShadow = '0 1px 4px rgba(0,0,0,0.35)';
    dot.style.transform = 'translateY(0)';
    dot.style.zIndex = '2';

    // подпись
    const lbl = document.createElement('div');
    lbl.className = 'custom-marker-label';
    lbl.textContent = title || rawAddress || '';
    // базовые inline-стили — но лучше ещё добавить CSS ниже
    lbl.style.fontSize = '12px';
    lbl.style.color = '#111';
    lbl.style.background = 'rgba(255,255,255,0.95)';
    lbl.style.padding = '4px 8px';
    lbl.style.borderRadius = '10px';
    lbl.style.boxShadow = '0 1px 3px rgba(0,0,0,0.15)';
    lbl.style.whiteSpace = 'nowrap';
    lbl.style.marginBottom = '6px';
    lbl.style.transform = 'translateY(-6px)';
    lbl.style.zIndex = '3';
    lbl.style.pointerEvents = 'none'; // чтобы клики шли на контейнер метки

    // упакуем: сначала подпись (над точкой), потом точка
    const wrapper = document.createElement('div');
    wrapper.style.display = 'flex';
    wrapper.style.flexDirection = 'column';
    wrapper.style.alignItems = 'center';
    wrapper.appendChild(lbl);
    wrapper.appendChild(dot);

    el.appendChild(wrapper);

    return el;
  }

  function addMarkerToMap(coords, title = '', rawAddress = '') {
    try {
      const markerElement = createMarkerElement(title, rawAddress);
      const marker = new YMapMarker({ coordinates: coords }, markerElement);
      map.addChild(marker);

      // клик по метке -> найти карточку с таким адресом и скроллить к ней
      try {
        const elToMatch = markerElement.getAttribute('data-address');
        markerElement.addEventListener('click', () => {
          if (!elToMatch) return;
          const all = Array.from(document.querySelectorAll('.cardLocationText'));
          const target = all.find(x => normalizeAddress(x.textContent) === elToMatch);
          if (target) {
            target.closest('.sectionCard')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // можно также выделить карточку визуально
            const card = target.closest('.sectionCard');
            if (card) {
              card.classList.add('highlight-temp');
              setTimeout(() => card.classList.remove('highlight-temp'), 2000);
            }
          }
        });
      } catch (e) {
        console.warn('Не удалось повесить клик на метку', e);
      }

      return marker;
    } catch (err) {
      console.error('Ошибка при создании YMapMarker', err);
      return null;
    }
  }

  const els = Array.from(document.querySelectorAll('.cardLocationText'));
  if (!els.length) { console.warn('Не найдено .cardLocationText'); return; }
  console.log('Найдено адресов:', els.length);

  const added = [];
  for (const el of els) {
    const raw = el.textContent.trim();
    const address = raw.replace(/^г\.\s*/i, '').trim();
    const title = el.closest('.sectionCard')?.querySelector('h2')?.textContent?.trim() || '';
    console.log('Геокодим:', raw, '=>', address);
    const coords = await geocodeAddress(address);
    if (coords) {
      console.log('Координаты:', coords);
      addMarkerToMap(coords, title, address);
      added.push(coords);
    } else {
      console.warn('Координаты не найдены для', address);
    }
    await new Promise(r => setTimeout(r, 200));
  }

  if (added.length) {
    try {
      if (typeof map.setLocation === 'function') {
        map.setLocation({ center: added[0], zoom: 13 });
      } else {
        console.log('map.setLocation недоступен — оставляем исходный центр');
      }
    } catch (e) {
      console.warn('Не удалось центрировать карту', e);
    }
  } else {
    console.log('Маркеры не добавлены — оставляем исходный центр');
  }
})();
</script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <div class="logoContainer">
         <img src="./assets/logo.svg" alt="logo map course" class="mainLogo">
      </div>

      <nav class="nav-desktop">
        <a href="#">Все категории</a>
        <a href="#">Новости</a>
        <a href="#">Помощь</a>
      </nav>

      <div class="header-right-desktop">
        <button class="icon-btn" aria-label="Избранное">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
          </svg>
        </button>
        <a href="#">
          <span>Профиль</span>
          <div class="avatar">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="24" height="24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
            </svg>
          </div>
        </a>
        <a href="#">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
          </svg>
          <span>Ростов-на-Дону</span>
        </a>
      </div>

      <div class="header-right-mobile">
        <button class="icon-btn" aria-label="Избранное">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
          </svg>
        </button>
        <button class="icon-btn" id="menuBtn" aria-label="Меню">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="menuOverlay"></div>
  <div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-header">
      <button class="icon-btn" id="closeMenuBtn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="mobile-menu-content">
      <div class="mobile-menu-profile">
        <div class="avatar">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="32" height="32">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
          </svg>
        </div>
        <div>
          <p style="font-weight: 500;">Профиль</p>
          <p style="font-size: 14px; opacity: 0.8;">Ростов-на-Дону</p>
        </div>
      </div>
      <nav>
        <a href="#">Все категории</a>
        <a href="#">Новости</a>
        <a href="#">Помощь</a>
        <a href="#">Избранное</a>
      </nav>
    </div>
  </div>

  <!-- Desktop Layout -->
  <main class="main-desktop">
    <div class="map-container">
      <div id="map">   
      </div>
      </div>
    </div>

    <div class="left-panel">
      <div class="search-filter">
        <button class="filter-btn">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="24" height="24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
          </svg>
          Фильтры
        </button>
        <div class="search-box">
          <input type="search" placeholder="поиск кружка!">
          <button type="submit">Найти</button>
        </div>
      </div>

      <div class="cards-container">
        <div class="cards-list" id="desktopCards"></div>
      </div>
    </div>
  </main>

  <!-- Mobile Layout -->
  <main class="main-mobile">
    <div class="mobile-map" id="map">
    </div>

    <div class="bottom-sheet split" id="bottomSheet">
      <div class="sheet-handle" id="sheetHandle">
        <div class="handle-bar"></div>
      </div>
      <div class="sheet-content">
        <div class="search-filter">
          <button class="filter-btn">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
            </svg>
            Фильтры
          </button>
          <div class="search-box">
            <input type="search" placeholder="поиск кружка!">
            <button type="submit">Найти</button>
          </div>
        </div>
        <div class="sheet-cards" id="mobileCards"></div>
      </div>
    </div>
  </main>

  <script>
    // Club data
    const clubs = [
      {
        id: 1,
        name: "Каратэ «Кодокан»",
        slug: "karate-tigr",
        description: "В кружке каратэ ребёнок освоит базовые приёмы, укрепит тело и характер, научится дисциплине и уважению. Программы адаптированы по возрасту: игровые задания для младших и техника для старших. Ждем вас на пробное занятие!",
        image: "https://images.unsplash.com/photo-1555597673-b21d5c935865?w=400&h=400&fit=crop",
        location: "г. Ростов-на-Дону, ул. Ленина 49",
        isFavorite: false,
        tags: ["каратэ", "боевые искусства", "самооборона", "спорт", "дети"]
      },
      {
        id: 2,
        name: "Школа Балета «Гармония»",
        slug: "ballet-gracia",
        description: "Здесь ваши дети научатся самовыражению, приобретут гибкость, ловкость и координацию движений. Мы поможем раскрыть потенциал вашего ребенка и подарим любовь к изящному с самого раннего детства. Не упустите шанс стать частью нашей дружной семьи!",
        image: "https://images.unsplash.com/photo-1518834107812-67b0b7c58434?w=400&h=400&fit=crop",
        location: "г. Ростов-на-Дону, пр-кт. Королева 10/4",
        isFavorite: true,
        tags: ["балет", "танцы", "хореография", "классический танец"]
      }
    ];

    // Generate card HTML
    function createCardHTML(club) {
      return `
        <div class="club-card">
          <div class="card-top">
            <div class="card-image">
              <img src="${club.image}" alt="${club.name}">
              <button class="favorite-btn ${club.isFavorite ? 'active' : ''}" data-id="${club.id}">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                </svg>
              </button>
            </div>
            <div class="card-content">
              <h2 class="card-title">${club.name}</h2>
              <div class="card-description">${club.description}</div>
            </div>
          </div>
          <div class="card-tags">
            ${club.tags.map(tag => `<button class="tag-btn">${tag}</button>`).join('')}
          </div>
          <div class="card-bottom">
            <div class="card-location">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
              </svg>
              <span>${club.location}</span>
            </div>
            <div class="card-buttons">
              <a href="club.html?slug=${club.slug}" class="card-btn">Подробнее</a>
              <button class="card-btn">Написать</button>
            </div>
          </div>
        </div>
      `;
    }

    // Render cards
    document.getElementById('desktopCards').innerHTML = clubs.map(createCardHTML).join('');
    document.getElementById('mobileCards').innerHTML = clubs.map(createCardHTML).join('');

    // Mobile menu
    const menuBtn = document.getElementById('menuBtn');
    const closeMenuBtn = document.getElementById('closeMenuBtn');
    const menuOverlay = document.getElementById('menuOverlay');
    const mobileMenu = document.getElementById('mobileMenu');

    function openMenu() {
      menuOverlay.classList.add('active');
      mobileMenu.classList.add('active');
    }

    function closeMenu() {
      menuOverlay.classList.remove('active');
      mobileMenu.classList.remove('active');
    }

    menuBtn.addEventListener('click', openMenu);
    closeMenuBtn.addEventListener('click', closeMenu);
    menuOverlay.addEventListener('click', closeMenu);

    // Bottom sheet
    const bottomSheet = document.getElementById('bottomSheet');
    const sheetHandle = document.getElementById('sheetHandle');
    const mobileMap = document.getElementById('mobileMap');
    let sheetState = 'split';
    let isDragging = false;
    let startY = 0;
    let startTranslateY = 0;

    function getTranslateY(state) {
      const vh = window.innerHeight;
      switch(state) {
        case 'peek': return vh - 56 - 84;
        case 'split': return (vh - 56) / 2;
        case 'full': return 0;
        default: return (vh - 56) / 2;
      }
    }

    function updateMapHeight() {
      const vh = window.innerHeight;
      switch(sheetState) {
        case 'peek':
          mobileMap.style.height = `calc(100vh - 84px - 56px)`;
          break;
        case 'split':
          mobileMap.style.height = `calc(50vh - 56px)`;
          break;
        case 'full':
          mobileMap.style.height = '40vh';
          break;
      }
    }

    function setSheetState(state) {
      sheetState = state;
      bottomSheet.className = 'bottom-sheet ' + state;
      updateMapHeight();
    }

    sheetHandle.addEventListener('click', () => {
      if (sheetState === 'peek') setSheetState('split');
      else if (sheetState === 'split') setSheetState('full');
      else setSheetState('peek');
    });

    sheetHandle.addEventListener('touchstart', (e) => {
      isDragging = true;
      startY = e.touches[0].clientY;
      bottomSheet.style.transition = 'none';
    });

    document.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      const deltaY = e.touches[0].clientY - startY;
      
      if (deltaY > 50) {
        if (sheetState === 'full') setSheetState('split');
        else if (sheetState === 'split') setSheetState('peek');
        isDragging = false;
      } else if (deltaY < -50) {
        if (sheetState === 'peek') setSheetState('split');
        else if (sheetState === 'split') setSheetState('full');
        isDragging = false;
      }
    });

    document.addEventListener('touchend', () => {
      isDragging = false;
      bottomSheet.style.transition = '';
    });

    // Favorite toggle
    document.addEventListener('click', (e) => {
      if (e.target.closest('.favorite-btn')) {
        const btn = e.target.closest('.favorite-btn');
        btn.classList.toggle('active');
      }
    });

    // Initial setup
    updateMapHeight();
  </script>
</body>
</html>
